#include <stdint.h>
#include <pongis.h>
#define MAXVEL 10

#define B 0x000000
#define G 0x00FF00
#define R 0xFF0000
#define Y 0xFFFF00
#define C 0x00FFFF
#define M 0xFF00FF
#define P 0x800080
#define GRAY 0x808080
#define DG 0x404040
#define LIGHT_GRAY 0xC0C0C0
#define BLUE 0x0000FF
#define ORANGE 0xFFA500
#define AQUA 0x00FFFF
#define W 0xFFFFFF



uint32_t AutoL[][21] = {
    {0x000000,0x000000,0x000000,0x000000,0x1CFFBA,0x1CFF9A,0x1CFF9A,0x000000,0x000000,0x1CFF9A,0x1CFF9A,0x1CFFBA,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},
    {0x000000,0x000000,0x07FFFC,0x0A40FE,0x000000,0x000000,0x000000,0x1CFF9E,0x1CFF9E,0x000000,0x000000,0x000000,0x0A40FE,0x07FFFC,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},
    {0x000000,0x000000,0x000000,0x040000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x040000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},
    {0x03E0F0,0x03E0F0,0x000000,0x01BF00,0x030040,0x030060,0x030060,0x030060,0x030060,0x030060,0x030060,0x030040,0x01BF00,0x000000,0x03E0F0,0x03E0F0,0x000000,0x000000,0x000000,0x000000,0x000000},
};

uint32_t AutoR[][21] = {
    {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x0BBFE7,0x0B3FE7,0x0B3FE7,0x000000,0x000000,0x0B3FE7,0x0B3FE7,0x0BBFE7,0x000000,0x000000,0x000000,0x000000},
    {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x07FFFC,0x0FE04A,0x000000,0x000000,0x000000,0x0F3FE7,0x0F3FE7,0x000000,0x000000,0x000000,0x0FE04A,0x07FFFC,0x000000,0x000000},
    {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000004,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000004,0x000000,0x000000,0x000000},
    {0x000000,0x000000,0x000000,0x000000,0x000000,0x01E0F8,0x01E0F8,0x000000,0x001FB0,0x004018,0x00C018,0x00C018,0x00C018,0x00C018,0x00C018,0x00C018,0x004018,0x001FB0,0x000000,0x01E0F8,0x01E0F8},
};

uint32_t AutoD[][21] = {
    {0x000000,0x01CE00,0x000000,0x01CE00,0x01CE00,0x010200,0x000000,0x01CE00,0x01CE00,0x01CE00,0x01CE00,0x01CE00,0x01CE00,0x01CE00,0x01CE00,0x01CE00,0x000000,0x000000,0x01CE00,0x01CE00,0x01CE00},
    {0x000000,0x023100,0x063180,0x063180,0x063180,0x060180,0x060180,0x063180,0x043080,0x043080,0x043080,0x043080,0x043080,0x043080,0x063180,0x043080,0x040080,0x060180,0x043080,0x023100,0x003000},
    {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x020100,0x000000,0x000000},
    {0x000000,0x000000,0x000000,0x000000,0x180060,0x18FC60,0x19FE60,0x180060,0x020100,0x020100,0x020100,0x020100,0x020100,0x1A0160,0x180060,0x1A0160,0x1BFF60,0x19FE60,0x000000,0x000000,0x000000},
};

uint32_t AutoU[][21] = {
    {0x0E70,0x0E70,0x0E70,0x0000,0x0000,0x0E70,0x0E70,0x0E70,0x0E70,0x0E70,0x0E70,0x0E70,0x0E70,0x0E70,0x0000,0x0810,0x0E70,0x0E70,0x0000,0x0E70,0x0000},
    {0x0180,0x1188,0x2184,0x300C,0x2004,0x2184,0x318C,0x2184,0x2184,0x2184,0x2184,0x2184,0x2184,0x318C,0x300C,0x300C,0x318C,0x318C,0x318C,0x1188,0x0000},
    {0x0000,0x0000,0x1008,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000},
    {0x0000,0x0000,0x0000,0xCFF3,0xDFFB,0xD00B,0xC003,0xD00B,0x1008,0x1008,0x1008,0x1008,0x1008,0xC003,0xCFF3,0xC7E3,0xC003,0x0000,0x0000,0x0000,0x0000},
};

uint32_t pelota[][15] = {
    {0x03E0,0x0FF8,0x1FC4,0x3F82,0x3F82,0x7F83,0x7FC7,0x7FFF,0x7FFF,0x7FFF,0x3FFE,0x3FFE,0x1FFC,0x0FF8,0x03E0},
    {0x0000,0x0000,0x0038,0x007C,0x007C,0x007C,0x0038,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000}
};

body p1 = {50,50, 0, 0, 0, 0, 0, 0, 0, 10, 10};
body p2 = {2000, 2000, 0, 0, 0, 0, 0, 0, 0, 10, 10};
body ball = {0,0, 0, 0, 0, 0, 0, 0, 0, 7, 7};

void drawBall(uint64_t x,uint64_t y) {
    sysConfigBitmap(2, R, 15);
    sysDrawBitmap(x,y,pelota[0]);
    sysConfigBitmap(2, W, 15);
    sysDrawBitmap(x,y,pelota[1]);
}
void drawPlayer(uint64_t x,uint64_t y,uint32_t bitmap[][21],int player){
    if(player == 1){
        sysConfigBitmap(3, Y, 21);
        sysDrawBitmap(x,y,bitmap[0]);
        sysConfigBitmap(3, R, 21);
        sysDrawBitmap(x,y,bitmap[1]);
        sysConfigBitmap(3, W, 21);
        sysDrawBitmap(x,y,bitmap[2]);
        sysConfigBitmap(3, DG, 21);
        sysDrawBitmap(x,y,bitmap[3]);
    }
    else{
        sysConfigBitmap(3, P, 21);
        sysDrawBitmap(x,y,bitmap[0]);
        sysConfigBitmap(3, B, 21);
        sysDrawBitmap(x,y,bitmap[1]);
        sysConfigBitmap(3, W, 21);
        sysDrawBitmap(x,y,bitmap[2]);
        sysConfigBitmap(3, DG, 21);
        sysDrawBitmap(x,y,bitmap[3]);
    }
}
int checkDireccion(float *angle) {
    if(*angle > 2 * PI)
        *angle = *angle - 2 * PI;
    if(*angle < 0)
        *angle = *angle + 2 * PI;
    if((*angle >= (7.0/4.0) * PI) && (*angle < (PI/4.0)))
        return 1;
    if((*angle >= (PI/4.0)) && (*angle < (3.0/4.0) * PI))
        return 2;
    if((*angle >= (3.0/4.0) * PI) && (*angle < (5.0/4.0) * PI))
        return 3;
    if((*angle >= (5.0/4.0) * PI) && (*angle < (7.0/4.0) * PI))
        return 4;
}

void play(void) {
    sysClear();
    char c = sysKey();
    float s, cs; 
    switch(c) {
        case 'w':
            sincosf(p1.angle, &s, &cs);
            p1.x = p1.x + 8 * s;
            p1.y = p1.y + 8 * cs;
            break;
        case 'a':
            p1.angle = p1.angle + PI/6.0;
            break;
        case 'd':
            p1.angle = p1.angle - PI/6.0;
            break;
    }
    if(p1.vel_y != 0)
        p1.vel_y = (p1.vel_y > 0) ? (p1.vel_y - 1) : (p1.vel_y + 1);

    p1.x = p1.x + p1.vel_x;
    p1.y = p1.y + p1.vel_y;
    if(p1.vel_x > MAXVEL)
        p1.vel_x = MAXVEL;
    if(p1.vel_y > MAXVEL)
        ball.vel_y = MAXVEL;

    switch(checkDireccion(&p1.angle)) {
        case 1:
            drawPlayer(p1.x - p1.x_offset, p1.y - p1.y_offset, AutoD, 1);
            break;
        case 2:
            drawPlayer(p1.x - p1.x_offset, p1.y - p1.y_offset, AutoR, 1);
            break;
        case 3:
            drawPlayer(p1.x - p1.x_offset, p1.y - p1.y_offset, AutoU, 1);
            break;
        case 4:
            drawPlayer(p1.x - p1.x_offset, p1.y - p1.y_offset, AutoL, 1);
            break;
        default:
            drawPlayer(p1.x - p1.x_offset, p1.y - p1.y_offset, AutoD, 1);
            break;
    }
    
    sysDraw();
}

void Pongis(void) {
    sysClear();
    drawPlayer(p1.x-p1.x_offset,p1.y-p1.y_offset,AutoU,1);
    drawBall(ball.x,ball.y);
    sysDraw();
    int lastTime = sysTimeTicks();
	int deltaTime = 0;
    while(1){
            play();
    }
}
//typedef struct {
   // uint64_t x;
    //uint64_t y;
    //uint64_t acceleration_x;
    //uint64_t acceleration_y;
    //uint64_t vel_x;
    //uint64_t vel_y;
    //float angle;
    //uint64_t max_speed;
    //uint64_t max_acceleration;
    //int x_offset;
    //int y_offset;
//} body;