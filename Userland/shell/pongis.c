#include <stdint.h>
#include <pongis.h>
#define MAXVEL 10

#define B 0x000000
#define G 0x00FF00
#define R 0xFF0000
#define Y 0xFFFF00
#define C 0x00FFFF
#define M 0xFF00FF
#define P 0x800080
#define GRAY 0x808080
#define DG 0x404040
#define LIGHT_GRAY 0xC0C0C0
#define BLUE 0x0000FF
#define ORANGE 0xFFA500
#define AQUA 0x00FFFF
#define W 0xFFFFFF

uint32_t nave[][21]={
    {0x000000,0x000000,0x030000,0x03C000,0x03F000,0x03FC00,0x03C700,0x0329C0,0x0329F0,0x0286FC,0x024000,0x0286FC,0x0329F0,0x0329C0,0x03C700,0x03FC00,0x03F000,0x03C000,0x030000,0x000000,0x000000},
    {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x043800,0x04D600,0x04D600,0x013900,0x01FFFF,0x013900,0x04D600,0x04D600,0x043800,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},

    {0x000000,0x000004,0x00001A,0x000074,0x0001EC,0x0007D8,0x001FB8,0x006370,0x0194F0,0x079CE0,0x0F6360,0x072280,0x036340,0x019C80,0x009480,0x006300,0x003F00,0x001E00,0x000E00,0x000400,0x000000},
    {0x000000,0x000002,0x000004,0x000008,0x000010,0x000020,0x000040,0x001C80,0x006B00,0x006300,0x009C80,0x00DD80,0x009C80,0x046300,0x066B00,0x001C00,0x004000,0x006000,0x000000,0x000000,0x000000},

    {0x000000,0x000000,0x000A00,0x000A00,0x001B00,0x001B00,0x003B80,0x003B80,0x0071C0,0x004A40,0x00CA60,0x00B1A0,0x018030,0x01B1B0,0x03C478,0x03CA78,0x07F1FC,0x07FFFC,0x000000,0x000000,0x000000},
    {0x000400,0x000400,0x000400,0x000400,0x000400,0x000400,0x000400,0x000400,0x000E00,0x003580,0x003580,0x004E40,0x007FC0,0x004E40,0x003580,0x003580,0x000E00,0x000000,0x0071C0,0x000000,0x000000},
    
    {0x000000,0x040000,0x0B0000,0x05C000,0x06F000,0x037C00,0x03BD00,0x01DAC0,0x01E530,0x00E73C,0x00D8DE,0x00489C,0x0058D8,0x002730,0x002520,0x0018C0,0x001F80,0x000F00,0x000E00,0x000400,0x000000},
    {0x000000,0x080000,0x040000,0x020000,0x010000,0x008000,0x004000,0x002700,0x001AC0,0x0018C0,0x002720,0x003760,0x002720,0x0018C8,0x001AD8,0x000700,0x000000,0x000040,0x0000C0,0x000000,0x000000},

    {0x000000,0x000000,0x000018,0x000078,0x0001F8,0x0007F8,0x001C78,0x007298,0x01F298,0x07EC28,0x000048,0x07EC28,0x01F298,0x007298,0x001C78,0x0007F8,0x0001F8,0x000078,0x000018,0x000000,0x000000},
    {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000384,0x000D64,0x000D64,0x001390,0x1FFFF0,0x001390,0x000D64,0x000D64,0x000384,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},

    {0x000000,0x000400,0x000E00,0x000F00,0x001F80,0x0018C0,0x002520,0x002730,0x0058D8,0x00289C,0x00D8DE,0x00E73C,0x01E530,0x01D8C0,0x03BF00,0x037C00,0x06F000,0x05C000,0x0B0000,0x040000,0x000000},
    {0x000000,0x000000,0x000000,0x0000C0,0x000040,0x000700,0x001ACC,0x0018C4,0x002720,0x003760,0x002720,0x0018C0,0x001AC0,0x002700,0x004000,0x008000,0x010000,0x020000,0x040000,0x080000,0x000000},

    {0x000000,0x000000,0x000000,0x07FFFC,0x07F1FC,0x03CA78,0x03C478,0x01B1B0,0x018030,0x00B1A0,0x00CA60,0x004A40,0x0071C0,0x003B80,0x003B80,0x001B00,0x001B00,0x000A00,0x000A00,0x000000,0x000000},
    {0x000000,0x000000,0x0071C0,0x000000,0x000E00,0x003580,0x003580,0x004E40,0x007FC0,0x004E40,0x003580,0x003580,0x000E00,0x000400,0x000400,0x000400,0x000400,0x000400,0x000400,0x000400,0x000400},

    {0x000000,0x000400,0x000E00,0x001E00,0x003F00,0x006300,0x009480,0x019C80,0x036340,0x072240,0x0F6360,0x079CE0,0x0194F0,0x006B70,0x0017B8,0x0007D8,0x0001EC,0x000074,0x00001A,0x000004,0x000000},
    {0x000000,0x000000,0x006000,0x004000,0x000000,0x001C00,0x036B00,0x026300,0x009C80,0x00DD80,0x009C80,0x006300,0x006B00,0x001C80,0x000040,0x000020,0x000010,0x000008,0x000004,0x000002,0x000000},


    

    

    
    {0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF,0xFFFFFF}
};
float angulos[8]={0,PI/4.0,PI/2.0,(3.0/4.0)*PI,PI,(5.0/4.0)*PI,(3.0/2.0)*PI,(7.0/4.0)*PI};

uint32_t pelota[][15] = {
    {0x03E0,0x0FF8,0x1FC4,0x3F82,0x3F82,0x7F83,0x7FC7,0x7FFF,0x7FFF,0x7FFF,0x3FFE,0x3FFE,0x1FFC,0x0FF8,0x03E0},
    {0x0000,0x0000,0x0038,0x007C,0x007C,0x007C,0x0038,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000},
    {0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF,0xFFFF}
};

body p1 = {50,50, 0, 0, 0, 10, 10, 10};
body p2 = {2000, 2000, 0, 0, 0, 0, 10, 10};
body ball = {200,200, 0, 0, 0, 0, 7, 7};

void drawBall() {
    sysConfigBitmap(2, R, 15);
    sysDrawBitmap(ball.x,ball.y,pelota[0]);
    sysConfigBitmap(2, W, 15);
    sysDrawBitmap(ball.x,ball.y,pelota[1]);
}
void drawPlayer(uint64_t x,uint64_t y,uint32_t bitmap[][21],int player){
    if(player == 1){

    }
    else{

    }
}


void play(void) {
    clearGame();

    printf("x: %d y: %d", p1.x, p1.y);

    char c = sysKey();
    float s, cs; 
    switch(c) {
        case 'w':
            sincosf(angulos[p1.rotation], &s, &cs);
            // Calcula la aceleración en función del ángulo seleccionado en el ciclo
            p1.vel_x += (int)(5 * cs);
            p1.vel_y += (int)(5 * (-s));
            break;
        case 'a':
            // Incrementa el índice de rotación cíclicamente (0 a 7)
            p1.rotation = (p1.rotation + 1) % 8;
            break;
        case 'd':
            // Decrementa el índice de rotación cíclicamente (usando módulo 8)
            p1.rotation = (p1.rotation + 7) % 8;
            break;
        default:
            break;
    }
    checkColissions(&p1,&ball,&p2);
    
    float drag = 0.9f; 
    p1.vel_x *= drag;
    p1.vel_y *= drag;
    ball.vel_x *= drag;
    ball.vel_y *= drag;


// Si es suficientemente bajo, ponelo en 0
    if (fabsf(p1.vel_x) < 0.5f) p1.vel_x = 0;
    if (fabsf(p1.vel_y) < 0.5f) p1.vel_y = 0;
    if (fabsf(ball.vel_x) < 0.5f) ball.vel_x = 0;
    if (fabsf(ball.vel_y) < 0.5f) ball.vel_y = 0;
    
    
    p1.x += p1.vel_x;
    p1.y += p1.vel_y;
    ball.x += ball.vel_x;
    ball.y += ball.vel_y*-1;
    
    // Dibuja la nave usando el sprite correspondiente:
    sysConfigBitmap(3, BLUE, 21);
    sysDrawBitmap(p1.x, p1.y, nave[p1.rotation * 2]);
    sysConfigBitmap(3, R, 21);
    sysDrawBitmap(p1.x, p1.y, nave[p1.rotation * 2 + 1]);
    drawBall();
    sysDraw();
}

void Pongis(void) {
    sysClear();
    while(1){
            play();
    }
}
clearGame(){
    sysConfigBitmap(3, B, 21);
    sysDrawBitmap(p1.x,p1.y,nave[16]);
    sysConfigBitmap(2, B, 15);
    sysDrawBitmap(ball.x,ball.y,pelota[2]);
    
    
}
//typedef struct {
   // uint64_t x;
    //uint64_t y;
    //uint64_t acceleration_x;
    //uint64_t acceleration_y;
    //uint64_t vel_x;
    //uint64_t vel_y;
    //float angle;
    //uint64_t max_speed;
    //uint64_t max_acceleration;
    //int x_offset;
    //int y_offset;
//} body;